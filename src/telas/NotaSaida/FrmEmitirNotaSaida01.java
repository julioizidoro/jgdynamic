/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package telas.NotaSaida;

import Regras.AliquotaController;
import Regras.ClienteController;
import Regras.CodigoFiscalController;
import Regras.ContasReceberController;
import Regras.Formatacao;
import Regras.IbptController;
import Regras.MunicipiosController;
import Regras.NotaSaidaController;
import Regras.ParametroLocalController;
import Regras.ProdutoController;
import Regras.VendaController;
import com.toedter.calendar.JTextFieldDateEditor;
import controler.Config;
import controler.UsuarioLogado;
import facade.TerminalVendasFacade;
import java.awt.Image;
import java.awt.Toolkit;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Timer;
import java.util.TimerTask;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.SwingConstants;
import javax.swing.table.DefaultTableCellRenderer;
import model.Aliquota;
import model.Cliente;
import model.Clienteendereco;
import model.Codigofiscal;
import model.Contasreceber;
import model.Contasreceberprodutos;
import model.Fornecedor;
import model.Ibpt;
import model.Municipios;
import model.NotaSaida;
import model.ParametrosLocal;
import model.Produto;
import model.Saida;
import model.Terminalcliente;
import model.Terminalproduto;
import model.Venda;
import telas.Cliente.FrmConsultaClientes;
import telas.NotaSaida.Fatura.DuplicataBean;
import telas.NotaSaida.Fatura.DuplicataTableModel;
import telas.NotaSaida.Fatura.FaturaBean;
import telas.NotaSaida.Fatura.FrmConsultaFatura;

/**
 *
 * @author wolverine
 */
public class FrmEmitirNotaSaida01 extends javax.swing.JFrame implements INotaSaidaBean{
    
    private String datePattern;
    private String maskPattern;
    private char placeHolder;
    private NotaSaidaBean notaSaidaBean;
    private List<NotaSaidaProdutoBean> listaProdutoBean;
    private Cliente cliente;
    private Config config;
    private Clienteendereco clienteEndereco;
    private ListaProdutoSaidaBeanTableModel modelProduto;
    private UsuarioLogado usuarioLogado;
    private FileWriter arquivo;
    private String caminhoXML;
    private File arquivoXML;
    private boolean notaCarregarda;
    private String chaveAutorizacao;
    private ParametrosLocal parametrosLocal;
    private DuplicataTableModel modelDuplicata;
    private INotaSaidaBean telaConsulta;
    private String numeroECFVenda;

    /**
     * Creates new form FrmEmitirNotaSaida
     */
    public FrmEmitirNotaSaida01(Config config, UsuarioLogado usuarioLogado, INotaSaidaBean telaConsulta) {
        notaSaidaBean = new NotaSaidaBean();
        this.telaConsulta = telaConsulta;
        this.notaCarregarda = false;
        notaSaidaBean.setNumeroOrdemECF("0");
        this.usuarioLogado = usuarioLogado;
        listaProdutoBean = new ArrayList<NotaSaidaProdutoBean>();
        datePattern = "dd/MM/yyyy";
        maskPattern = "##/##/##";
        placeHolder = '_';
        this.config = config;
        initComponents();
        URL url = this.getClass().getResource("/imagens/logo_mini.png");
        Image imagemTitulo = Toolkit.getDefaultToolkit().getImage(url);
        this.setIconImage(imagemTitulo);
        this.setLocationRelativeTo(null);
        carregarComboBoxCFOP();
        gerarNumeroNFe();
        ParametroLocalController parametroLocalController = new ParametroLocalController();
        parametrosLocal = parametroLocalController.localizarEmpresa(this.config.getEmpresa().getIdparametros());
        dataEmissaojDateChooser.setDate(new Date());
        this.setVisible(true);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        comSTjComboBox = new javax.swing.JComboBox();
        jLabel2 = new javax.swing.JLabel();
        semSTjComboBox = new javax.swing.JComboBox();
        jLabel3 = new javax.swing.JLabel();
        tipoNFejComboBox = new javax.swing.JComboBox();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        numeroNFejTextField = new javax.swing.JTextField();
        seriejTextField = new javax.swing.JTextField();
        naturezaOperacaojTextField = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        dataEmissaojDateChooser = new com.toedter.calendar.JDateChooser(null, null, datePattern, new JTextFieldDateEditor(datePattern,
            maskPattern, placeHolder));
    jLabel7 = new javax.swing.JLabel();
    jLabel8 = new javax.swing.JLabel();
    totalProdutojTextField = new javax.swing.JTextField();
    jLabel9 = new javax.swing.JLabel();
    totalNotajTextField = new javax.swing.JTextField();
    jButton1 = new javax.swing.JButton();
    observacaojTextField = new javax.swing.JTextField();
    jLabel23 = new javax.swing.JLabel();
    jPanel4 = new javax.swing.JPanel();
    gerarjButton = new javax.swing.JButton();
    valorDescontojTextField = new javax.swing.JTextField();
    jLabel16 = new javax.swing.JLabel();
    jLabel17 = new javax.swing.JLabel();
    valorTributosjTextField = new javax.swing.JTextField();
    jPanel2 = new javax.swing.JPanel();
    jLabel10 = new javax.swing.JLabel();
    nomejTextField = new javax.swing.JTextField();
    jLabel11 = new javax.swing.JLabel();
    cpfjFormattedTextField = new javax.swing.JFormattedTextField();
    rgjTextField = new javax.swing.JTextField();
    jLabel12 = new javax.swing.JLabel();
    foneFixojFormattedTextField = new javax.swing.JFormattedTextField();
    jLabel13 = new javax.swing.JLabel();
    emailjTextField = new javax.swing.JTextField();
    jLabel15 = new javax.swing.JLabel();
    complementojTextField = new javax.swing.JTextField();
    jLabel24 = new javax.swing.JLabel();
    numerojTextField = new javax.swing.JTextField();
    jLabel25 = new javax.swing.JLabel();
    jLabel26 = new javax.swing.JLabel();
    logradourojTextFiel = new javax.swing.JTextField();
    cidadejTextField = new javax.swing.JTextField();
    jLabel27 = new javax.swing.JLabel();
    cepjFormattedTextField = new javax.swing.JFormattedTextField();
    jLabel28 = new javax.swing.JLabel();
    bairrojTextField = new javax.swing.JTextField();
    jLabel29 = new javax.swing.JLabel();
    estadojComboBox = new javax.swing.JComboBox();
    jLabel30 = new javax.swing.JLabel();
    jButton7 = new javax.swing.JButton();
    contribuintejComboBox = new javax.swing.JComboBox();
    jPanel3 = new javax.swing.JPanel();
    jScrollPane1 = new javax.swing.JScrollPane();
    produtojTable = new javax.swing.JTable();
    jButton2 = new javax.swing.JButton();
    jButton3 = new javax.swing.JButton();
    jButton4 = new javax.swing.JButton();
    jButton5 = new javax.swing.JButton();
    jButton8 = new javax.swing.JButton();
    jPanel5 = new javax.swing.JPanel();
    jLabel14 = new javax.swing.JLabel();
    formaPagamentojComboBox = new javax.swing.JComboBox();
    jPanel6 = new javax.swing.JPanel();
    jLabel18 = new javax.swing.JLabel();
    numeroFaturajTextField = new javax.swing.JTextField();
    jLabel19 = new javax.swing.JLabel();
    valorOriginalFaturajTextField = new javax.swing.JTextField();
    jLabel20 = new javax.swing.JLabel();
    valorDescontoFaturajTextField = new javax.swing.JTextField();
    jLabel21 = new javax.swing.JLabel();
    valorLiquidoFaturajTextField = new javax.swing.JTextField();
    jButton10 = new javax.swing.JButton();
    jButton11 = new javax.swing.JButton();
    jPanel10 = new javax.swing.JPanel();
    jScrollPane3 = new javax.swing.JScrollPane();
    duplicatajTable1 = new javax.swing.JTable();
    jPanel11 = new javax.swing.JPanel();
    jScrollPane4 = new javax.swing.JScrollPane();
    duplicatajTable = new javax.swing.JTable();
    jPanel12 = new javax.swing.JPanel();
    jLabel36 = new javax.swing.JLabel();
    numeroDuplicatajTextField = new javax.swing.JTextField();
    jLabel37 = new javax.swing.JLabel();
    dataVencimentoDuplicatajDateChooser = new com.toedter.calendar.JDateChooser(null, null, datePattern, new JTextFieldDateEditor(datePattern,
        maskPattern, placeHolder));
jLabel38 = new javax.swing.JLabel();
valorDuplicatajTextField = new javax.swing.JTextField();
jButton14 = new javax.swing.JButton();
jButton15 = new javax.swing.JButton();

setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
setTitle("Emitir NF-e");

jLabel1.setText("CFOP com ST");

jLabel2.setText("CFOP sem ST");

jLabel3.setText("Tipo de NF-e");

tipoNFejComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Saida", "Entrada", " " }));

jLabel4.setText("No. da NF-e");

jLabel5.setText("Série");

seriejTextField.setEditable(false);

naturezaOperacaojTextField.setText("Venda de Mercadorias");

jLabel6.setText("Natureza da Operação");

dataEmissaojDateChooser.addFocusListener(new java.awt.event.FocusAdapter() {
    public void focusGained(java.awt.event.FocusEvent evt) {
        dataEmissaojDateChooserFocusGained(evt);
    }
    });

    jLabel7.setText("Data Emissão");

    jLabel8.setText("Valor Total Produtos");

    totalProdutojTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
    totalProdutojTextField.setText("0");

    jLabel9.setText("Valor Total da Nota");

    totalNotajTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
    totalNotajTextField.setText("0");

    jButton1.setText("Calcular");
    jButton1.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton1ActionPerformed(evt);
        }
    });

    observacaojTextField.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            observacaojTextFieldActionPerformed(evt);
        }
    });

    jLabel23.setText("Informações Adcionais");

    jPanel4.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    gerarjButton.setText("Gerar NF-e");
    gerarjButton.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            gerarjButtonActionPerformed(evt);
        }
    });

    javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
    jPanel4.setLayout(jPanel4Layout);
    jPanel4Layout.setHorizontalGroup(
        jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel4Layout.createSequentialGroup()
            .addGap(278, 278, 278)
            .addComponent(gerarjButton, javax.swing.GroupLayout.PREFERRED_SIZE, 194, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );
    jPanel4Layout.setVerticalGroup(
        jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel4Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(gerarjButton, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );

    valorDescontojTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
    valorDescontojTextField.setText("0");

    jLabel16.setText("Valor Desconto");

    jLabel17.setText("Valor Tributos");

    valorTributosjTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
    valorTributosjTextField.setText("0");

    javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
    jPanel1.setLayout(jPanel1Layout);
    jPanel1Layout.setHorizontalGroup(
        jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel1Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createSequentialGroup()
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel23)
                        .addComponent(observacaojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 761, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel3)
                        .addComponent(jLabel2)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(semSTjComboBox, javax.swing.GroupLayout.Alignment.LEADING, 0, 777, Short.MAX_VALUE)
                            .addComponent(comSTjComboBox, javax.swing.GroupLayout.Alignment.LEADING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGroup(jPanel1Layout.createSequentialGroup()
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(dataEmissaojDateChooser, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jLabel7, javax.swing.GroupLayout.PREFERRED_SIZE, 72, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGap(44, 44, 44)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel8)
                                .addComponent(totalProdutojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 132, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGap(17, 17, 17)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(valorDescontojTextField, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 105, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jLabel16, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 115, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(valorTributosjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 105, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGroup(jPanel1Layout.createSequentialGroup()
                                    .addComponent(jLabel17, javax.swing.GroupLayout.PREFERRED_SIZE, 115, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(2, 2, 2)
                                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jLabel9)
                                        .addComponent(totalNotajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 106, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addGap(6, 6, 6)
                                    .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 152, javax.swing.GroupLayout.PREFERRED_SIZE))))
                        .addGroup(jPanel1Layout.createSequentialGroup()
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addComponent(tipoNFejComboBox, javax.swing.GroupLayout.Alignment.LEADING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel1)
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(jLabel4)
                                            .addComponent(numeroNFejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGap(23, 23, 23)
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(jLabel5)
                                            .addComponent(seriejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                            .addGap(29, 29, 29)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel6)
                                .addComponent(naturezaOperacaojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 550, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGap(0, 0, Short.MAX_VALUE)))
            .addContainerGap())
    );
    jPanel1Layout.setVerticalGroup(
        jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel1Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jLabel1)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(comSTjComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 9, Short.MAX_VALUE)
            .addComponent(jLabel2)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(semSTjComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addComponent(jLabel3)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(tipoNFejComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(jLabel4)
                .addComponent(jLabel5)
                .addComponent(jLabel6))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(numeroNFejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(seriejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(naturezaOperacaojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel1Layout.createSequentialGroup()
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel9)
                            .addComponent(jLabel17)
                            .addComponent(jLabel16))
                        .addComponent(jLabel7, javax.swing.GroupLayout.Alignment.TRAILING))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(dataEmissaojDateChooser, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jButton1)))
                .addGroup(jPanel1Layout.createSequentialGroup()
                    .addComponent(jLabel8)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(totalProdutojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(valorDescontojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(valorTributosjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(totalNotajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
            .addGap(18, 18, 18)
            .addComponent(jLabel23)
            .addGap(4, 4, 4)
            .addComponent(observacaojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGap(93, 93, 93))
    );

    jTabbedPane1.addTab("Dados da NF-e", jPanel1);

    jLabel10.setText("Nome");

    nomejTextField.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            nomejTextFieldActionPerformed(evt);
        }
    });

    jLabel11.setText("Nº CNPJ");

    cpfjFormattedTextField.addFocusListener(new java.awt.event.FocusAdapter() {
        public void focusLost(java.awt.event.FocusEvent evt) {
            cpfjFormattedTextFieldFocusLost(evt);
        }
    });

    jLabel12.setText("Inscrição Estadual");

    jLabel13.setText("Fone Fixo");

    jLabel15.setText("E-mail");

    jLabel24.setText("Logradouro");

    jLabel25.setText("Número");

    jLabel26.setText("Complemento");

    cidadejTextField.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            cidadejTextFieldActionPerformed(evt);
        }
    });

    jLabel27.setText("Cidade");

    jLabel28.setText("CEP");

    jLabel29.setText("Bairro");

    estadojComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "SC", "RS", "PR", "SP", "RJ", "ES", "MG", "MT", "MS", "BH" }));

    jLabel30.setText("Estado");

    jButton7.setText("Consultar Cliente");
    jButton7.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton7ActionPerformed(evt);
        }
    });

    contribuintejComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "1 - Contribuinto do ICMS", "2 - Contribuinte isento de IE", "9 - Não Contribuinto do ICMS" }));

    javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
    jPanel2.setLayout(jPanel2Layout);
    jPanel2Layout.setHorizontalGroup(
        jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel2Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel2Layout.createSequentialGroup()
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(logradourojTextFiel, javax.swing.GroupLayout.PREFERRED_SIZE, 433, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel24))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel25)
                        .addComponent(numerojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 81, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(complementojTextField)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addComponent(jLabel26)
                            .addGap(0, 0, Short.MAX_VALUE))))
                .addComponent(nomejTextField)
                .addGroup(jPanel2Layout.createSequentialGroup()
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel11)
                        .addComponent(cpfjFormattedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 135, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addComponent(rgjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 116, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addComponent(jLabel12)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                    .addGap(9, 9, 9)
                    .addComponent(contribuintejComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, 162, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGap(18, 18, 18)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(foneFixojFormattedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 124, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel13))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel15)
                        .addComponent(emailjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGroup(jPanel2Layout.createSequentialGroup()
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel29)
                        .addComponent(bairrojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 183, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGap(27, 27, 27)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel28)
                        .addComponent(cepjFormattedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 102, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addGap(34, 34, 34)
                            .addComponent(jLabel27)
                            .addGap(303, 303, 303))
                        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(cidadejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 339, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGap(18, 18, 18)))
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(estadojComboBox, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addComponent(jLabel30, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGap(0, 0, Short.MAX_VALUE))))
                .addGroup(jPanel2Layout.createSequentialGroup()
                    .addComponent(jLabel10)
                    .addGap(0, 0, Short.MAX_VALUE))
                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addComponent(jButton7)))
            .addContainerGap())
    );
    jPanel2Layout.setVerticalGroup(
        jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel2Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jLabel10)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(nomejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGap(12, 12, 12)
            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel2Layout.createSequentialGroup()
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel11)
                        .addComponent(jLabel12)
                        .addComponent(jLabel15))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(cpfjFormattedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(rgjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(emailjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(contribuintejComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel24)
                        .addComponent(jLabel25)
                        .addComponent(jLabel26))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(complementojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(numerojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(logradourojTextFiel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(jLabel29)
                                .addComponent(jLabel28)
                                .addComponent(jLabel27))
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(bairrojTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(cepjFormattedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(estadojComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(cidadejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addComponent(jLabel30, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addComponent(jButton7))
                .addGroup(jPanel2Layout.createSequentialGroup()
                    .addComponent(jLabel13)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(foneFixojFormattedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
            .addContainerGap(236, Short.MAX_VALUE))
    );

    jTabbedPane1.addTab("Cliente", jPanel2);

    produtojTable.setModel(new javax.swing.table.DefaultTableModel(
        new Object [][] {
            {null, null, null, null, null, null, null},
            {null, null, null, null, null, null, null},
            {null, null, null, null, null, null, null},
            {null, null, null, null, null, null, null}
        },
        new String [] {
            "Código", "Descrição", "Unidade", "NCM", "Quantidade", "Valor Unitario", "Valor Total"
        }
    ) {
        boolean[] canEdit = new boolean [] {
            false, false, false, false, false, false, false
        };

        public boolean isCellEditable(int rowIndex, int columnIndex) {
            return canEdit [columnIndex];
        }
    });
    jScrollPane1.setViewportView(produtojTable);
    if (produtojTable.getColumnModel().getColumnCount() > 0) {
        produtojTable.getColumnModel().getColumn(0).setResizable(false);
        produtojTable.getColumnModel().getColumn(1).setResizable(false);
        produtojTable.getColumnModel().getColumn(2).setResizable(false);
        produtojTable.getColumnModel().getColumn(3).setResizable(false);
        produtojTable.getColumnModel().getColumn(4).setResizable(false);
        produtojTable.getColumnModel().getColumn(5).setResizable(false);
        produtojTable.getColumnModel().getColumn(6).setResizable(false);
    }

    jButton2.setText("Incluir Produtos Contas");
    jButton2.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton2ActionPerformed(evt);
        }
    });

    jButton3.setText("Incluir Produtos Venda");
    jButton3.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton3ActionPerformed(evt);
        }
    });

    jButton4.setText("Excluir Produtos");
    jButton4.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton4ActionPerformed(evt);
        }
    });

    jButton5.setText("Alterar NCM");
    jButton5.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton5ActionPerformed(evt);
        }
    });

    jButton8.setText("Incluir Fatura");
    jButton8.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton8ActionPerformed(evt);
        }
    });

    javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
    jPanel3.setLayout(jPanel3Layout);
    jPanel3Layout.setHorizontalGroup(
        jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel3Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jScrollPane1)
            .addContainerGap())
        .addGroup(jPanel3Layout.createSequentialGroup()
            .addGap(41, 41, 41)
            .addComponent(jButton2)
            .addGap(49, 49, 49)
            .addComponent(jButton3)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 63, Short.MAX_VALUE)
            .addComponent(jButton8)
            .addGap(38, 38, 38)
            .addComponent(jButton4)
            .addGap(34, 34, 34)
            .addComponent(jButton5)
            .addGap(30, 30, 30))
    );
    jPanel3Layout.setVerticalGroup(
        jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel3Layout.createSequentialGroup()
            .addContainerGap(45, Short.MAX_VALUE)
            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 368, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGap(18, 18, 18)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(jButton2)
                .addComponent(jButton3)
                .addComponent(jButton4)
                .addComponent(jButton5)
                .addComponent(jButton8))
            .addContainerGap())
    );

    jTabbedPane1.addTab("Produtos", jPanel3);

    jLabel14.setText("Forma de Pagamento");

    formaPagamentojComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "A VISTA", "A PRAZO", "OUTROS" }));

    jPanel6.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    jLabel18.setText("Nº Fatura");

    jLabel19.setText("Valor Original R$");

    valorOriginalFaturajTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

    jLabel20.setText("Valor Desconto R$");

    valorDescontoFaturajTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

    jLabel21.setText("Valor Líquido");

    valorLiquidoFaturajTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

    javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
    jPanel6.setLayout(jPanel6Layout);
    jPanel6Layout.setHorizontalGroup(
        jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel6Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(valorDescontoFaturajTextField, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 103, Short.MAX_VALUE)
                    .addComponent(numeroFaturajTextField, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel18, javax.swing.GroupLayout.Alignment.LEADING))
                .addComponent(jLabel20))
            .addGap(18, 18, 18)
            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                .addComponent(jLabel21)
                .addComponent(jLabel19)
                .addComponent(valorOriginalFaturajTextField)
                .addComponent(valorLiquidoFaturajTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 114, Short.MAX_VALUE))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );
    jPanel6Layout.setVerticalGroup(
        jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel6Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(jLabel18)
                .addComponent(jLabel19))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(numeroFaturajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(valorOriginalFaturajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(jLabel20)
                .addComponent(jLabel21))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(valorDescontoFaturajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(valorLiquidoFaturajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addContainerGap(23, Short.MAX_VALUE))
    );

    jButton10.setText("Consultar Fatura");
    jButton10.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton10ActionPerformed(evt);
        }
    });

    jButton11.setText("Carregar Produtos");
    jButton11.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton11ActionPerformed(evt);
        }
    });

    jPanel10.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    duplicatajTable1.setModel(new javax.swing.table.DefaultTableModel(
        new Object [][] {
            {null, null, null},
            {null, null, null},
            {null, null, null},
            {null, null, null}
        },
        new String [] {
            "Nº Duplicata", "Data Vencimento", "Valor Duplicata R$"
        }
    ) {
        boolean[] canEdit = new boolean [] {
            false, false, false
        };

        public boolean isCellEditable(int rowIndex, int columnIndex) {
            return canEdit [columnIndex];
        }
    });
    jScrollPane3.setViewportView(duplicatajTable1);
    if (duplicatajTable1.getColumnModel().getColumnCount() > 0) {
        duplicatajTable1.getColumnModel().getColumn(0).setResizable(false);
        duplicatajTable1.getColumnModel().getColumn(1).setResizable(false);
        duplicatajTable1.getColumnModel().getColumn(2).setResizable(false);
    }

    javax.swing.GroupLayout jPanel10Layout = new javax.swing.GroupLayout(jPanel10);
    jPanel10.setLayout(jPanel10Layout);
    jPanel10Layout.setHorizontalGroup(
        jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel10Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 508, Short.MAX_VALUE)
            .addContainerGap())
    );
    jPanel10Layout.setVerticalGroup(
        jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel10Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 221, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );

    jPanel11.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    duplicatajTable.setModel(new javax.swing.table.DefaultTableModel(
        new Object [][] {
            {null, null, null},
            {null, null, null},
            {null, null, null},
            {null, null, null}
        },
        new String [] {
            "Nº Duplicata", "Data Vencimento", "Valor Duplicata R$"
        }
    ) {
        boolean[] canEdit = new boolean [] {
            false, false, false
        };

        public boolean isCellEditable(int rowIndex, int columnIndex) {
            return canEdit [columnIndex];
        }
    });
    jScrollPane4.setViewportView(duplicatajTable);
    if (duplicatajTable.getColumnModel().getColumnCount() > 0) {
        duplicatajTable.getColumnModel().getColumn(0).setResizable(false);
        duplicatajTable.getColumnModel().getColumn(1).setResizable(false);
        duplicatajTable.getColumnModel().getColumn(2).setResizable(false);
    }

    javax.swing.GroupLayout jPanel11Layout = new javax.swing.GroupLayout(jPanel11);
    jPanel11.setLayout(jPanel11Layout);
    jPanel11Layout.setHorizontalGroup(
        jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel11Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jScrollPane4, javax.swing.GroupLayout.DEFAULT_SIZE, 506, Short.MAX_VALUE)
            .addContainerGap())
    );
    jPanel11Layout.setVerticalGroup(
        jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel11Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
            .addContainerGap())
    );

    jPanel12.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    jLabel36.setText("Nº Duplicata");

    jLabel37.setText("Data Vencimento");

    dataVencimentoDuplicatajDateChooser.addFocusListener(new java.awt.event.FocusAdapter() {
        public void focusGained(java.awt.event.FocusEvent evt) {
            dataVencimentoDuplicatajDateChooserFocusGained(evt);
        }
    });

    jLabel38.setText("Valor Duplicata R$");

    valorDuplicatajTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

    jButton14.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/tick.png"))); // NOI18N
    jButton14.setText("Incluir");
    jButton14.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton14ActionPerformed(evt);
        }
    });

    jButton15.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/cross.png"))); // NOI18N
    jButton15.setText("Excluir");
    jButton15.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton15ActionPerformed(evt);
        }
    });

    javax.swing.GroupLayout jPanel12Layout = new javax.swing.GroupLayout(jPanel12);
    jPanel12.setLayout(jPanel12Layout);
    jPanel12Layout.setHorizontalGroup(
        jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel12Layout.createSequentialGroup()
            .addGap(19, 19, 19)
            .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jLabel36)
                .addComponent(numeroDuplicatajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 99, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGap(22, 22, 22)
            .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jLabel37)
                .addComponent(dataVencimentoDuplicatajDateChooser, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGap(32, 32, 32)
            .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jLabel38, javax.swing.GroupLayout.PREFERRED_SIZE, 102, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(valorDuplicatajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 113, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 29, Short.MAX_VALUE)
            .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jButton15, javax.swing.GroupLayout.Alignment.TRAILING)
                .addComponent(jButton14, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addContainerGap())
    );
    jPanel12Layout.setVerticalGroup(
        jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel12Layout.createSequentialGroup()
            .addGap(25, 25, 25)
            .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(jLabel36)
                .addComponent(jLabel37)
                .addComponent(jLabel38))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(numeroDuplicatajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(dataVencimentoDuplicatajDateChooser, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(valorDuplicatajTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButton15)))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        .addGroup(jPanel12Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jButton14)
            .addGap(0, 0, Short.MAX_VALUE))
    );

    javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
    jPanel5.setLayout(jPanel5Layout);
    jPanel5Layout.setHorizontalGroup(
        jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel5Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel5Layout.createSequentialGroup()
                    .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addComponent(jButton10, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jButton11, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jPanel12, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jPanel11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGap(1094, 1094, 1094)
                    .addComponent(jPanel10, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addComponent(jLabel14)
                .addComponent(formaPagamentojComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, 209, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );
    jPanel5Layout.setVerticalGroup(
        jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel5Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jLabel14)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(formaPagamentojComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGap(18, 18, 18)
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel5Layout.createSequentialGroup()
                    .addComponent(jPanel12, javax.swing.GroupLayout.PREFERRED_SIZE, 81, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(jPanel11, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGroup(jPanel5Layout.createSequentialGroup()
                    .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel5Layout.createSequentialGroup()
                            .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(jButton10)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                            .addComponent(jButton11))
                        .addGroup(jPanel5Layout.createSequentialGroup()
                            .addGap(92, 92, 92)
                            .addComponent(jPanel10, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGap(0, 46, Short.MAX_VALUE)))
            .addContainerGap())
    );

    jTabbedPane1.addTab("Dados de Cobrança", jPanel5);

    javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
    getContentPane().setLayout(layout);
    layout.setHorizontalGroup(
        layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 843, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );
    layout.setVerticalGroup(
        layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 493, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap())
    );

    pack();
    }// </editor-fold>//GEN-END:initComponents

    private void dataEmissaojDateChooserFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_dataEmissaojDateChooserFocusGained
        // TODO add your handling code here:
    }//GEN-LAST:event_dataEmissaojDateChooserFocusGained

    private void nomejTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nomejTextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_nomejTextFieldActionPerformed

    private void cpfjFormattedTextFieldFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_cpfjFormattedTextFieldFocusLost
    }//GEN-LAST:event_cpfjFormattedTextFieldFocusLost

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        int linha = produtojTable.getSelectedRow();
        if (linha>=0){
            listaProdutoBean.remove(linha);
            setModelProduto();
        }
    }//GEN-LAST:event_jButton4ActionPerformed

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
       int linha = produtojTable.getSelectedRow();
       if (linha>=0){
           String ncm = "";
           ncm = JOptionPane.showInputDialog("Informe NCM Somente Numeros");
           listaProdutoBean.get(linha).getProduto().setNcm(ncm);
           ProdutoController produtoController = new ProdutoController();
           Produto prod = produtoController.consultarProdutoid(listaProdutoBean.get(linha).getProduto().getIdProduto());
           if (prod!=null){
               prod.setNcm(ncm);
               produtoController.salvarProduto(prod);
           }
           setModelProduto();
       }else{
           JOptionPane.showMessageDialog(rootPane, "Selecione um produto");
       }
    }//GEN-LAST:event_jButton5ActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        if (cliente!=null){
            new FrmConsultaProdutoConta(config, cliente.getIdcliente(), this);
        }else JOptionPane.showMessageDialog(rootPane, "Cliente não selecionado");
    }//GEN-LAST:event_jButton2ActionPerformed

    private void jButton7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton7ActionPerformed
        new FrmConsultaClientes(config, usuarioLogado, this);
    }//GEN-LAST:event_jButton7ActionPerformed

    private void observacaojTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_observacaojTextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_observacaojTextFieldActionPerformed

    private void cidadejTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cidadejTextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cidadejTextFieldActionPerformed

    private void gerarjButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_gerarjButtonActionPerformed
        gerarjButton.setText("Aguarde Gerando NF-e");
        String erro = validarDadosNFe();
        if (erro != null) {
            JOptionPane.showMessageDialog(rootPane, erro);
            gerarjButton.setText("Gerar NF-e");
        } else {
            
            notaSaidaBean.setCliente(cliente);
            notaSaidaBean.setClienteEndereco(clienteEndereco);
            notaSaidaBean.setEmpresa(this.config.getEmpresa());
            notaSaidaBean.setDataEmissao((dataEmissaojDateChooser.getDate()));
            notaSaidaBean.setDataSaida((dataEmissaojDateChooser.getDate()));
            notaSaidaBean.setFormaPagamento(formaPagamentojComboBox.getSelectedItem().toString());
            notaSaidaBean.setListaProdutos(listaProdutoBean);
            notaSaidaBean.setNaturezaOperacao(naturezaOperacaojTextField.getText());
            notaSaidaBean.setCodigo(numeroNFejTextField.getText());
            notaSaidaBean.setNuemro(numeroNFejTextField.getText());
            notaSaidaBean.setTipo(tipoNFejComboBox.getSelectedItem().toString());
            notaSaidaBean.setSerie1(seriejTextField.getText());
            notaSaidaBean.setSerie2("");
            if (notaSaidaBean.getFatura() != null) {
                notaSaidaBean.getFatura().setNumero(numeroFaturajTextField.getText());
                notaSaidaBean.getFatura().setValorDesconto(Formatacao.formatarStringfloat(valorDescontoFaturajTextField.getText()));
                notaSaidaBean.getFatura().setValorLiquido(Formatacao.formatarStringfloat(valorLiquidoFaturajTextField.getText()));
                notaSaidaBean.getFatura().setValorOrigianl(Formatacao.formatarStringfloat(valorOriginalFaturajTextField.getText()));
            }
            calcularTotaisNotaFiscal();
            notaSaidaBean.setInfoTexto("EMPRESA ENQUADRADA NO SIMPLES NACIONAL");
            try {
                gerarArquivoNFe();
//                salvarNumeroNFe();
                String texto = "NFE.CriarEnviarNFeSefaz(" +
                this.config.getCaminhoNFe() + "ctexto.txt,1)";
                gerarArquivoAcbr(texto);
                Timer timer = new Timer();
                timer.schedule(new RemindTask(), 20 * 1000);
            } catch (IOException ex) {
                Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_gerarjButtonActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        try {
            new FrmSelecionarClienteTerminal(this);
        } catch (Exception ex) {
            Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jButton3ActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        calcularTotaisNotaFiscal();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton8ActionPerformed
        String numeroFatura = JOptionPane.showInputDialog("Informe o número da fatura");
    }//GEN-LAST:event_jButton8ActionPerformed

    private void dataVencimentoDuplicatajDateChooserFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_dataVencimentoDuplicatajDateChooserFocusGained
        // TODO add your handling code here:
    }//GEN-LAST:event_dataVencimentoDuplicatajDateChooserFocusGained

    private void jButton11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton11ActionPerformed
        if (notaSaidaBean.getFatura()!=null){
            buscarContasFatura(notaSaidaBean.getFatura().getNumero());
        }
    }//GEN-LAST:event_jButton11ActionPerformed

    private void jButton10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton10ActionPerformed
        new FrmConsultaFatura(cliente, config, this);
    }//GEN-LAST:event_jButton10ActionPerformed

    private void jButton14ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton14ActionPerformed
        String erro = validarFaturaDuplicata();
        if (erro.equalsIgnoreCase("0")) {
            if (notaSaidaBean.getFatura() == null) {
                notaSaidaBean.setFormaPagamento("A PRAZO");
                notaSaidaBean.setFatura(new FaturaBean());
                notaSaidaBean.getFatura().setListaDuplicata(new ArrayList<DuplicataBean>());
            }
            DuplicataBean duplicataBean = new DuplicataBean();
            duplicataBean.setDataVencimento(dataVencimentoDuplicatajDateChooser.getDate());
            duplicataBean.setNumero(numeroDuplicatajTextField.getText());
            duplicataBean.setValor(Formatacao.ConvercaoMonetariaFloat(valorDuplicatajTextField.getText()));
            notaSaidaBean.getFatura().getListaDuplicata().add(duplicataBean);
            carregarModelDuplicata();
            numeroDuplicatajTextField.setText("");
            valorDuplicatajTextField.setText("");
            numeroDuplicatajTextField.requestFocus();
        } else {
            JOptionPane.showMessageDialog(rootPane, erro);
        }
        
    }//GEN-LAST:event_jButton14ActionPerformed

    private void jButton15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton15ActionPerformed
        int linha = duplicatajTable.getSelectedRow();
        if (linha>=0){
            notaSaidaBean.getFatura().getListaDuplicata().remove(linha);
            carregarModelDuplicata();
        }
    }//GEN-LAST:event_jButton15ActionPerformed

    /**
     * @param ags the command line arguments
     */
   
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField bairrojTextField;
    private javax.swing.JFormattedTextField cepjFormattedTextField;
    private javax.swing.JTextField cidadejTextField;
    private javax.swing.JComboBox comSTjComboBox;
    private javax.swing.JTextField complementojTextField;
    private javax.swing.JComboBox contribuintejComboBox;
    private javax.swing.JFormattedTextField cpfjFormattedTextField;
    private com.toedter.calendar.JDateChooser dataEmissaojDateChooser;
    private com.toedter.calendar.JDateChooser dataVencimentoDuplicatajDateChooser;
    private javax.swing.JTable duplicatajTable;
    private javax.swing.JTable duplicatajTable1;
    private javax.swing.JTextField emailjTextField;
    private javax.swing.JComboBox estadojComboBox;
    private javax.swing.JFormattedTextField foneFixojFormattedTextField;
    private javax.swing.JComboBox formaPagamentojComboBox;
    private javax.swing.JButton gerarjButton;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton10;
    private javax.swing.JButton jButton11;
    private javax.swing.JButton jButton14;
    private javax.swing.JButton jButton15;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton7;
    private javax.swing.JButton jButton8;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel20;
    private javax.swing.JLabel jLabel21;
    private javax.swing.JLabel jLabel23;
    private javax.swing.JLabel jLabel24;
    private javax.swing.JLabel jLabel25;
    private javax.swing.JLabel jLabel26;
    private javax.swing.JLabel jLabel27;
    private javax.swing.JLabel jLabel28;
    private javax.swing.JLabel jLabel29;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel30;
    private javax.swing.JLabel jLabel36;
    private javax.swing.JLabel jLabel37;
    private javax.swing.JLabel jLabel38;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTextField logradourojTextFiel;
    private javax.swing.JTextField naturezaOperacaojTextField;
    private javax.swing.JTextField nomejTextField;
    private javax.swing.JTextField numeroDuplicatajTextField;
    private javax.swing.JTextField numeroFaturajTextField;
    private javax.swing.JTextField numeroNFejTextField;
    private javax.swing.JTextField numerojTextField;
    private javax.swing.JTextField observacaojTextField;
    private javax.swing.JTable produtojTable;
    private javax.swing.JTextField rgjTextField;
    private javax.swing.JComboBox semSTjComboBox;
    private javax.swing.JTextField seriejTextField;
    private javax.swing.JComboBox tipoNFejComboBox;
    private javax.swing.JTextField totalNotajTextField;
    private javax.swing.JTextField totalProdutojTextField;
    private javax.swing.JTextField valorDescontoFaturajTextField;
    private javax.swing.JTextField valorDescontojTextField;
    private javax.swing.JTextField valorDuplicatajTextField;
    private javax.swing.JTextField valorLiquidoFaturajTextField;
    private javax.swing.JTextField valorOriginalFaturajTextField;
    private javax.swing.JTextField valorTributosjTextField;
    // End of variables declaration//GEN-END:variables
    public void setModelProduto(){
        if (listaProdutoBean==null){
            listaProdutoBean = new ArrayList<NotaSaidaProdutoBean>();
        }
        modelProduto = new ListaProdutoSaidaBeanTableModel(listaProdutoBean);
        produtojTable.setModel(modelProduto);
        DefaultTableCellRenderer renderer = new DefaultTableCellRenderer();
        renderer.setHorizontalAlignment(SwingConstants.RIGHT);
        produtojTable.getColumnModel().getColumn(0).setPreferredWidth(20);
        produtojTable.getColumnModel().getColumn(1).setPreferredWidth(100);
        produtojTable.getColumnModel().getColumn(2).setPreferredWidth(20);
        produtojTable.getColumnModel().getColumn(3).setPreferredWidth(20);
        produtojTable.getColumnModel().getColumn(4).setCellRenderer(renderer);
        produtojTable.getColumnModel().getColumn(4).setPreferredWidth(30);
        produtojTable.getColumnModel().getColumn(5).setCellRenderer(renderer);
        produtojTable.getColumnModel().getColumn(5).setPreferredWidth(30);
        produtojTable.getColumnModel().getColumn(6).setCellRenderer(renderer);
        produtojTable.getColumnModel().getColumn(6).setPreferredWidth(30);
        produtojTable.repaint();
    }

    
    

    public void incluirProdutoVenda(Object objeto) {
        throw new UnsupportedOperationException("Not supported yet.");
    }
    
    public String pesquisarAliquota(int idAliquota){
        AliquotaController aliquotaController = new AliquotaController();
        Aliquota aliquota = aliquotaController.buscarAliquotaid(idAliquota);
        if (aliquota!=null){
            return aliquota.getDescricao();
        }
        return "";
    }

    public void consultarCliente(Cliente cliente) {
        this.cliente = cliente;
        if (cliente!=null){
            nomejTextField.setText(cliente.getNome());
            cpfjFormattedTextField.setText(cliente.getDocFederal());
            if (cliente.getTipo().equalsIgnoreCase("PJ")){
                rgjTextField.setText(cliente.getDocEstadual());
            }else {
                rgjTextField.setText("");
            }
            foneFixojFormattedTextField.setText(cliente.getFoneFixo());
            emailjTextField.setText(cliente.getEmail());
            ClienteController clienteController = new ClienteController();
            clienteEndereco = clienteController.consultarClienteEndereco(cliente.getIdcliente());
            logradourojTextFiel.setText(clienteEndereco.getTipoLogradouro() + " " + clienteEndereco.getLogradouro());
            numerojTextField.setText(clienteEndereco.getNumero());
            complementojTextField.setText(clienteEndereco.getComplemento());
            bairrojTextField.setText(clienteEndereco.getBairro());
            cidadejTextField.setText(clienteEndereco.getCidade());
            cepjFormattedTextField.setText(clienteEndereco.getCep());
            estadojComboBox.setSelectedItem(clienteEndereco.getEstado());
            emailjTextField.setText(cliente.getEmail());
            if (emailjTextField.getText().length()==0){
                JOptionPane.showMessageDialog(rootPane, "Email é obrigatório");
            }
        }
    }
    
    public void carregarComboBoxCFOP(){
        CodigoFiscalController codigoFiscalController = new CodigoFiscalController();
        List<Codigofiscal> listaCodigoFiscal = codigoFiscalController.listarCodigoFiscal("SST");
        if (listaCodigoFiscal!=null){
            for(int i=0;i<listaCodigoFiscal.size();i++){
                comSTjComboBox.addItem(listaCodigoFiscal.get(i));
            }
        }
        listaCodigoFiscal = codigoFiscalController.listarCodigoFiscal("CST");
        if (listaCodigoFiscal!=null){
            for(int i=0;i<listaCodigoFiscal.size();i++){
                semSTjComboBox.addItem(listaCodigoFiscal.get(i));
            }
        }
    }
    
   public void gerarArquivoAcbr(String texto) {
        try {
            FileWriter acbr = new FileWriter(new File(this.config.getCaminhoAcbr() + "ENTNFE.txt"));
            acbr.write(texto);
            acbr.close();
        } catch (IOException ex) {
            Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
        }
       
   }
   
   public void lerArquivoSaidaAcbr() throws IOException{
       File arqSaida = new File(this.config.getCaminhoAcbr() + "sainfe.txt");
        String xml = null;
        BufferedReader leitor = null;
        FileReader sainfe;
        while (!arqSaida.exists()) {
            arqSaida = new File(this.config.getCaminhoAcbr() + "sainfe.txt");
        }
        if (!arqSaida.exists()){
            JOptionPane.showMessageDialog(rootPane, "Arquivo de Saída não Localizado");
        }
        sainfe = new FileReader(arqSaida);
        leitor = new BufferedReader(sainfe);
        xml = leitor.readLine();

        String linha = xml.substring(0, 2);
        if (linha.equalsIgnoreCase("OK")) {
            if (verificarRetornoNFe(leitor)){
                JOptionPane.showMessageDialog(rootPane, "Nota Fiscal Gerada com Sucesso");
                gerarjButton.setText("Gerar NF-e");
                carregarCahveAutorizacao(leitor);
                new FrmLocalizarArquivoNFe(this, this.config.getCaminhoNFe());
            }
        }else {
            JOptionPane.showMessageDialog(rootPane, "Erro oa gerar Nota Fiscal");
            gerarjButton.setText("Gerar NF-e");
            new FrmMostrarErroNotaSaida(leitor);
            leitor.close();
            apagarArquivoSaidaAcbr();
        }
        leitor.close();
        
    }
    
    public void gerarArquivoNFe() throws IOException{
        arquivo = new FileWriter(new File(this.config.getCaminhoNFe() + "cTexto.txt"));
        notaSaidaBean.setHoraSaida(Formatacao.foramtarHoraString());
        //Identificaoção
        arquivo.write("NOTAFISCAL|1" + "\r\n");
        gerarDadosNotaFiscal();
        gerarDadosCupomFiscalReferenciado();
        gerarDadosEmitente();
        gerarDadosDestinatario();
        gerarDadosProduto();
        gerarTotaisSimplesNacional();
        if (notaSaidaBean.getFormaPagamento().equalsIgnoreCase("A PRAZO")){
            if (notaSaidaBean.getFatura()!=null){
                gerarFatura();
                if (notaSaidaBean.getFatura().getListaDuplicata()!=null){
                    gerarDuplicatas();
                }
            }
        }
        arquivo.close();
    }
    
    public void gerarDadosNotaFiscal() throws IOException{
        arquivo.write("A|2.00||" + "\r\n");
        arquivo.write("B|"); //B01
        arquivo.write("42|");//Codigo do Estado SC=42 B02
        arquivo.write("|"); //B03
        arquivo.write(validarTamanho(notaSaidaBean.getNaturezaOperacao()) + "|"); //B04
        arquivo.write(verificarFormaPagamento() + "|"); //B05
        arquivo.write("55|"); //B06 
        arquivo.write(notaSaidaBean.getSerie1()+ "|");//B07
        arquivo.write(notaSaidaBean.getNuemro() + "|");//B08
        arquivo.write(converterDataUTC() + "|");//B09
        arquivo.write(converterDataUTC() + "|");//B10
        arquivo.write(verificarTipoNFe() + "|"); //B11
        arquivo.write(verficiarOepracao()+ "|");//Identificador da Oepração 1 - Estadual 2- Fora do Estado 3 - Exterior //B11a
        arquivo.write("4205407|");//Codigo Municipio //B12
        arquivo.write("1|");//Formato de Impressao do Danfe //B21
        arquivo.write("1|");//Forma de Emissao da NF-e //B22
        arquivo.write("|");//Digito verificar do Chave de acesso na informar na importacao //B23
        arquivo.write("1|");//Identificaocao do Hambiente  //B24
        arquivo.write("1|");//finalidade da Emissao da NF-e 1 - Normal //B25
        arquivo.write("0|");//Indica operacao consumidor final 0 - Nao   1-Cosumidor final //B25a
        arquivo.write("1|");//Indica de presença do comprador //B25b
        arquivo.write("3|" + parametrosLocal.getVersaonfe());//Processo de emissao da NF-e B26 e B27
        arquivo.write("|||");
        arquivo.write("\r\n");
    }
    
    public void gerarDadosCupomFiscalReferenciado() throws IOException{        
        if (!notaSaidaBean.getNumeroOrdemECF().equalsIgnoreCase("0")){
            arquivo.write("BA20|");//BA20
            arquivo.write("2D|"); //BA21
            arquivo.write(notaSaidaBean.getNumeroOrdemECF() + "|"); //BA22
            arquivo.write(notaSaidaBean.getNumeroCOO() + "|"); //BA23
            arquivo.write("\r\n");
        }
    }
    
    public void gerarDadosEmitente() throws IOException{
        // Dados do Emitente
        arquivo.write("C|");//Classe Dados do Emitente //C01
        arquivo.write(validarTamanho(notaSaidaBean.getEmpresa().getRazaoSocial()) + "|");//RazaoSocial
        arquivo.write(validarTamanho(notaSaidaBean.getEmpresa().getNomeFantasia()) + "|");//Nome Fantasia
        arquivo.write(retirarPontos(notaSaidaBean.getEmpresa().getInscricaoEstadual() + "|"));//Inscricao Estadual
        arquivo.write("|");//Inscricao Estadual ST
        arquivo.write(notaSaidaBean.getEmpresa().getInscricaoMunicipal() + "|"); //Inscricao Municipal
        arquivo.write(notaSaidaBean.getEmpresa().getCnae() + "|"); //Numero da Codigo Ativadade Economoca
        arquivo.write(notaSaidaBean.getEmpresa().getCrt() + "|"); //Se a empresa e enquadrada ou nao no Simples
        arquivo.write("\r\n");
        
        //Dados do CNPJ
        arquivo.write("C02|");
        arquivo.write(retirarPontos(notaSaidaBean.getEmpresa().getCnpj()) + "|" + "\r\n");
        
        //Dados do Endereco
        arquivo.write("C05|");
        arquivo.write(validarTamanho(notaSaidaBean.getEmpresa().getTipoLogradouro() + " " +  notaSaidaBean.getEmpresa().getLogradouro()) + "|");
        arquivo.write(notaSaidaBean.getEmpresa().getNumero() + "|");
        arquivo.write(validarTamanho(notaSaidaBean.getEmpresa().getComplemento()) + "|");
        arquivo.write(validarTamanho(notaSaidaBean.getEmpresa().getBairro()) + "|");
        arquivo.write(consultarCodgioMunicipio(notaSaidaBean.getEmpresa().getMunicipios()) + "|");
        arquivo.write(validarTamanho(notaSaidaBean.getEmpresa().getCidade()) + "|");
        arquivo.write(notaSaidaBean.getEmpresa().getUf() + "|");
        arquivo.write(retirarPontos(notaSaidaBean.getEmpresa().getCep()) + "|");
        arquivo.write("1058" + "|");//Codigo Pais
        arquivo.write("Brasil" + "|"); //Pais
        arquivo.write(retirarPontos(notaSaidaBean.getEmpresa().getFoneComercial()) + "|");
        arquivo.write("\r\n");
    }
    
    public void gerarDadosDestinatario() throws IOException{
        //Dados do Destinatario
        arquivo.write("E|");//E01
        if (notaSaidaBean.getCliente().getTipo().equalsIgnoreCase("PF")){
            arquivo.write("E03|"); //E03
        }else {
            arquivo.write("E02|"); //E02
        }
        arquivo.write(retirarPontos(cpfjFormattedTextField.getText()) + "|"); //E02 ou E03
        arquivo.write(validarTamanho(nomejTextField.getText()) + "|"); //E04
        arquivo.write("\r\n");
        
        //Endereco do Destinatario
        arquivo.write("E05|"); //E05
        arquivo.write(validarTamanho(logradourojTextFiel.getText()) + "|");//E06
        arquivo.write(numerojTextField.getText() + "|");//E07
        arquivo.write(validarTamanho(complementojTextField.getText()) + "|");//E08
        arquivo.write(validarTamanho(bairrojTextField.getText()) + "|"); //E09
        arquivo.write(consultarCodgioMunicipio(notaSaidaBean.getClienteEndereco().getMunicipios()) + "|");//E10
        arquivo.write(validarTamanho(cidadejTextField.getText()) + "|");//E11
        arquivo.write(estadojComboBox.getSelectedItem().toString() + "|");//E12
        arquivo.write(retirarPontos(cepjFormattedTextField.getText()) + "|");//E12
        arquivo.write("1058" + "|");//E14
        arquivo.write("Brasil" + "|");//E15
        arquivo.write(retirarPontos(notaSaidaBean.getCliente().getFoneFixo()) + "|");//E16
        arquivo.write(verificarClienteICMS()+ "|");//E16a
        arquivo.write(retirarPontos(rgjTextField.getText())+ "|");//E17
        arquivo.write("||");//E18 e E18a
        arquivo.write(emailjTextField.getText() + "|");//E19
        arquivo.write("\r\n");
    }
    
    public void gerarDadosProduto() throws IOException{
        for (int i = 0; i < listaProdutoBean.size(); i++) {
            arquivo.write("H|");
            arquivo.write((i+1) + "|");//Numero do item
            arquivo.write("VALOR APROXIMADO DOS TRIBUTOS R$ " + Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getValorTributo()) +"|");//Informacoes Adicionais
            arquivo.write("\r\n");
            arquivo.write("I|");
            arquivo.write(String.valueOf(listaProdutoBean.get(i).getProduto().getReferencia()) + "|");
            arquivo.write(verificarCodgioBarras(listaProdutoBean.get(i).getProduto().getIdProduto()) + "|");//codigo Barras
            arquivo.write(listaProdutoBean.get(i).getProduto().getDescricao() + "|");
            arquivo.write(listaProdutoBean.get(i).getProduto().getNcm() + "|");
            arquivo.write("|");
            arquivo.write(listaProdutoBean.get(i).getCfop() + "|");
            arquivo.write(listaProdutoBean.get(i).getProduto().getUnidade() + "|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getQuantidade())) +"00" + "|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getValorUnitario())) + "00000000" + "|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getValortotal())) + "|");
            arquivo.write(verificarCodgioBarras(listaProdutoBean.get(i).getProduto().getIdProduto()) + "|");
            arquivo.write(listaProdutoBean.get(i).getProduto().getUnidade() + "|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getQuantidade())) +"00" + "|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getValorUnitario())) + "00000000" + "|");
            arquivo.write("|");
            arquivo.write("|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getValorDesconto())) + "|");
            arquivo.write("|");
            arquivo.write("1" + "|");
            arquivo.write("|");
            arquivo.write("|");
            arquivo.write("\r\n");
            arquivo.write("M|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(listaProdutoBean.get(i).getValorTributo())) + "|");
            arquivo.write("\r\n");
            arquivo.write("N|");
            arquivo.write("\r\n");
            if (listaProdutoBean.get(i).getProduto().getAliquota()==6){
                arquivo.write("N10g|0|500||||");
            }else {
                arquivo.write("N10g|0|102||||");
            }
            arquivo.write("\r\n");
            gerarPisSimplesNacional();
            gerarCofinsSimplesNacional();
            
        }
    }
    
    
    public void gerarTotaisSimplesNacional() throws IOException{
        arquivo.write("W|");
        arquivo.write("\r\n");
        arquivo.write("W02|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(notaSaidaBean.getTotalValoProdutos())) + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(notaSaidaBean.getValorDesconto())) + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write("0.00" + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(notaSaidaBean.getValorNota())) + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarDoubleString(notaSaidaBean.getTotalTributios())) + "|");
        arquivo.write("\r\n");
        arquivo.write("X|9|");
        arquivo.write("\r\n");
        arquivo.write("Z||" + notaSaidaBean.getInfoTexto() + " - VALOR APROXIMADO DOS TRIBUTOS R$ " +
                Formatacao.foramtarDoubleString(notaSaidaBean.getTotalTributios()) + "|");
    }
    
    public void gerarPisSimplesNacional() throws IOException{
        arquivo.write("Q|");
        arquivo.write("\r\n");
        arquivo.write("Q05|");
        arquivo.write("99"+ "|");
        arquivo.write("0.00"+ "|");
        arquivo.write("\r\n");
        arquivo.write("Q07|");
        arquivo.write("0.00"+ "|");
        arquivo.write("0.00"+ "|");
        arquivo.write("\r\n");
    }
    
    public void gerarCofinsSimplesNacional() throws IOException{
        arquivo.write("S|");
        arquivo.write("\r\n");
        arquivo.write("S05|");
        arquivo.write("99"+ "|");
        arquivo.write("0.00"+ "|");
        arquivo.write("\r\n");
        arquivo.write("S07|");
        arquivo.write("0.00"+ "|");
        arquivo.write("0.00"+ "|");
        arquivo.write("\r\n");
    }
    
    public void gerarFatura() throws IOException{
        arquivo.write("Y|");
        arquivo.write("\r\n");
        arquivo.write("Y02|");
        arquivo.write(notaSaidaBean.getFatura().getNumero() + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarFloatString(notaSaidaBean.getFatura().getValorOrigianl())) + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarFloatString(notaSaidaBean.getFatura().getValorDesconto())) + "|");
        arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarFloatString(notaSaidaBean.getFatura().getValorLiquido())) + "|");
        arquivo.write("\r\n");
    }
    
    public void gerarDuplicatas() throws IOException{
        for(int i=0;i<notaSaidaBean.getFatura().getListaDuplicata().size();i++){
            arquivo.write("Y07|");
            arquivo.write(notaSaidaBean.getFatura().getListaDuplicata().get(i).getNumero() + "|");
        //    arquivo.write(Formatacao.ConvercaoDataNfe(notaSaidaBean.getFatura().getListaDuplicata().get(i).getDataVencimento()) + "|");
            arquivo.write(FormatarValoreMonetarios(Formatacao.foramtarFloatString(notaSaidaBean.getFatura().getListaDuplicata().get(i).getValor()))+ "|");
            arquivo.write("\r\n");
        }   
    }
    
    public String retirarPontos(String dado){
        String formatado ="";
        char c = ' ';
        for(int i=0;i<dado.length();i++){
            c = dado.charAt(i);
            if ((c!='.') && (c!=',') && (c!='-') && (c!='/') && (c!='(') && (c!=')')){
               formatado+= c;
            }
        }
        return formatado;
    }
    
    public String FormatarValoreMonetarios(String dado){
        String formatado ="";
        char c = ' ';
        for(int i=0;i<dado.length();i++){
            c = dado.charAt(i);
            if ((c!='.')){
               if (c==','){
                   formatado+= '.';
               } else {
                   formatado+= c;
               }
            }
        }
        return formatado;
    }
    
    
    public String verificarFormaPagamento(){
        if (formaPagamentojComboBox.getSelectedItem().toString().equalsIgnoreCase("A VISTA")){
            return "0";
        }else if (formaPagamentojComboBox.getSelectedItem().toString().equalsIgnoreCase("A PRAZO")){
            return "1";
        }else return "2";
    }
    
    public String verificarTipoNFe(){
        if (tipoNFejComboBox.getSelectedItem().toString().equalsIgnoreCase("Saida")){
            return "1";
        }else if (tipoNFejComboBox.getSelectedItem().toString().equalsIgnoreCase("Entrada")){
            return "0";
        }else {
            return "1";
        }
    }
    
    public String verificarMMAACupomFiscal() {
        String dados;
        if (notaSaidaBean.getDataEmissaoCupomFiscal() != null) {
            dados = Formatacao.ConvercaoDataPadrao(notaSaidaBean.getDataEmissaoCupomFiscal());
            String ano = dados.substring(8, 9);
            String mes = dados.substring(3, 5);
            return ano + mes;
        }
        return "";
    }
    
    public String validarTamanho(String dados){
        if (dados.length()>60){
            return dados.substring(0, 59);
        }else return dados;
    }
    
    public String verificarCodgioBarras(int idProduto){
//        CodigoBarrasController codigoBarrasController = new CodigoBarrasController();
//        List<CodigoBarras> listaCodigoBarras = codigoBarrasController.pesquisarProduto(idProduto);
//        if (listaCodigoBarras!=null){
//            if (listaCodigoBarras.size()>0){
//                return listaCodigoBarras.get(0).getBarras();
//            }
//        }
        return "";
    }
    
    public String gerarCodigoNumeroChaveNFe(String numero){
        String zeros = "00000000";
        String dados = zeros.substring(numero.length()) + numero;
        return dados;
    }

    public void finalizarBuscaTerminalCliente(Terminalcliente terminalCliente) {
        
        TerminalVendasFacade terminalVendasFacade = new TerminalVendasFacade();
        List<Terminalproduto>  listaTerminalProduto = null;
        try {
            listaTerminalProduto = terminalVendasFacade.consultaTerminalProduto(terminalCliente);
        } catch (SQLException ex) {
            Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
        }
        for (int i=0;i<listaTerminalProduto.size();i++){
            Terminalproduto terminalProduto = listaTerminalProduto.get(i);
            NotaSaidaProdutoBean notaSaidaProdutoBean = new NotaSaidaProdutoBean();
            Produto produto = new Produto();
            ProdutoController produtoController = new ProdutoController();
            produto= produtoController.consultarProdutoid(terminalProduto.getProduto());
            if (produto!=null){
                notaSaidaProdutoBean.setProduto(produto);
                notaSaidaProdutoBean.setQuantidade(terminalProduto.getQuantidade());
                notaSaidaProdutoBean.setValorDesconto(0.0f);
                notaSaidaProdutoBean.setValorUnitario(terminalProduto.getValorUnitario());
                notaSaidaProdutoBean.setValortotal(terminalProduto.getValorUnitario() * terminalProduto.getQuantidade());
                String aliquota = pesquisarAliquota(notaSaidaProdutoBean.getProduto().getAliquota());
                if (aliquota.equalsIgnoreCase("ST")){
                    Codigofiscal cf = (Codigofiscal) comSTjComboBox.getSelectedItem();
                    notaSaidaProdutoBean.setCfop(cf.getCfop());
                }else{
                    Codigofiscal cf = (Codigofiscal) semSTjComboBox.getSelectedItem();
                    notaSaidaProdutoBean.setCfop(cf.getCfop());
                }
                listaProdutoBean.add(notaSaidaProdutoBean);
            }
        }
            
        try {
            terminalVendasFacade.excluirTerminalCliente(terminalCliente);
        } catch (SQLException ex) {
            Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
        }
        setModelProduto();
    }
    
    public void inlcluirProdutoContas(Object objeto) {
        List<NotaSaidaProdutoBean> lista = (List<NotaSaidaProdutoBean>) objeto;
        if (lista.size()>0){
            for(int i=0;i<lista.size();i++){
                NotaSaidaProdutoBean notaSaidaProdutoBean = lista.get(i);
                String aliquota = pesquisarAliquota(notaSaidaProdutoBean.getProduto().getAliquota());
                if (aliquota.equalsIgnoreCase("ST")){
                    Codigofiscal cf = (Codigofiscal) comSTjComboBox.getSelectedItem();
                    notaSaidaProdutoBean.setCfop(cf.getCfop());
                }else{
                    Codigofiscal cf = (Codigofiscal) semSTjComboBox.getSelectedItem();
                    notaSaidaProdutoBean.setCfop(cf.getCfop());
                }
                listaProdutoBean.add(notaSaidaProdutoBean);
            }
            setModelProduto();
        }
        
    }
    
    public void gerarNumeroNFe(){
        //Empresa emp = new Empresa();
        //emp = this.config.getEmpresa();
        NotaSaidaController notaSaidaController = new NotaSaidaController();
        int numeroNFe = notaSaidaController.consultarUltimaNotaEmitida();//emp.getNumeroNFe();
        if (numeroNFe>0){
            numeroNFe = numeroNFe + 1;
            numeroNFejTextField.setText(String.valueOf(numeroNFe));
            seriejTextField.setText(String.valueOf(this.config.getEmpresa().getSerieNFe()));
        }else {
            JOptionPane.showMessageDialog(rootPane, "Erro Gerar Numero Nota Fiscal");
        }
    }
    
//    public void salvarNumeroNFe(){
//        Empresa emp = new Empresa();
//        emp = this.config.getEmpresa();
//        emp.setNumeroNFe(Integer.parseInt(numeroNFejTextField.getText()));
//        EmpresaController empresaController = new EmpresaController();
//        emp = empresaController.salvar(emp);
//        this.config.setEmpresa(emp);
//    }
    
    
     public void calcularTotaisNotaFiscal(){
         notaSaidaBean.setValorDesconto(Formatacao.ConvercaoMonetariaDouble(valorDescontojTextField.getText()));
        calcularRateioDesconto();
        double valorTotalProdutos=0; 
        double valorTributos=0;
        double totalDesconto=0;
        double valorCalcualdo=0;
        IbptController ibptController = new IbptController();
        for(int i=0;i<listaProdutoBean.size();i++){
            valorTotalProdutos+=listaProdutoBean.get(i).getValortotal();
            Ibpt ibpt = new Ibpt();
            ibpt = ibptController.cunsultarIbpt(listaProdutoBean.get(i).getProduto().getNcm());
            double valor =0.0;
            if (ibpt!=null){
                valor = listaProdutoBean.get(i).getValortotal()*(ibpt.getAliquotaImposto()/100);
            }else {
                valor = listaProdutoBean.get(i).getValortotal()*(26.75/100);
            }
            listaProdutoBean.get(i).setValorTributo(valor);
            valorTributos+=listaProdutoBean.get(i).getValorTributo();
            if (notaSaidaBean.getPercentualDesconto()>0){
                double valorDesconto =  (listaProdutoBean.get(i).getValortotal() * notaSaidaBean.getPercentualDesconto());
                totalDesconto = totalDesconto + valorDesconto;
                if (totalDesconto> notaSaidaBean.getValorDesconto()){
                    valorDesconto = notaSaidaBean.getValorDesconto() - (totalDesconto - valorDesconto);
                }
                listaProdutoBean.get(i).setValorDesconto(valorDesconto);
                valorCalcualdo = valorCalcualdo + listaProdutoBean.get(i).getValorDesconto();
            }
        }
        notaSaidaBean.setTotalValoProdutos(valorTotalProdutos);
        notaSaidaBean.setValorNota(valorTotalProdutos - notaSaidaBean.getValorDesconto());
        notaSaidaBean.setTotalBaseICMS(0);
        notaSaidaBean.setTotalValorICMS(0);
        notaSaidaBean.setTotalTributios(valorTributos);
        totalProdutojTextField.setText(Formatacao.foramtarDoubleString(notaSaidaBean.getTotalValoProdutos()));
        totalNotajTextField.setText(Formatacao.foramtarDoubleString(notaSaidaBean.getValorNota())); 
        valorTributosjTextField.setText(Formatacao.foramtarDoubleString(notaSaidaBean.getTotalTributios()));
    }
     
     
   public String validarDadosNFe(){
       String erro=null;
       if (clienteEndereco.getMunicipios()==0){
           erro = "Falta código Municipio";
           return erro;
       }
       if (emailjTextField.getText().length()==0){
           erro = "Email inválido";
           return erro;
       }
       for(int i=0;i<listaProdutoBean.size();i++){
           if (listaProdutoBean.get(i).getProduto().getNcm().equalsIgnoreCase("0")){
               erro="Lista de Produtos possui NCM inválido";
               return erro;
           }
       }
       if (formaPagamentojComboBox.getSelectedItem().toString().equalsIgnoreCase("A PRAZO")){
           if (notaSaidaBean.getFatura()==null){
               erro = "Forma de Pagamento A PRAZO - sem Farura";
               return erro;
           }
           if (notaSaidaBean.getFatura().getListaDuplicata()==null){
               erro = "Fatura sem parcelas de Dupplicatas";
               return erro;
           }else {
               if (notaSaidaBean.getFatura().getListaDuplicata().size()==0){
                    erro = "Fatura sem parcelas de Dupplicatas";
                    return erro;
                }
           }
       }
       return erro;
   }
   
   public void gravarNotaSaida(){
       NotaSaida notaSaida = new NotaSaida();
       notaSaida.setIdcliente(cliente.getIdcliente());
       notaSaida.setIdfornecedor(0);
       notaSaida.setTipo("V");
       notaSaida.setDataEmissao(notaSaidaBean.getDataEmissao());
       notaSaida.setEmpresa(this.config.getEmpresa().getIdempresa());
       notaSaida.setNumero(Integer.parseInt(notaSaidaBean.getNuemro()));
       notaSaida.setSerie(Integer.parseInt(notaSaidaBean.getSerie1()));
       notaSaida.setSituacao("AUTORIZADA");
       notaSaida.setNomeArquivoXML(this.arquivoXML.getName());
       notaSaida.setUsuario(this.usuarioLogado.getUsuario().getIdusuarios());
       Double valor = notaSaidaBean.getValorNota();
       notaSaida.setValorNotaFiscal(valor.floatValue());
       valor = notaSaidaBean.getTotalValoProdutos();
       notaSaida.setValorProdutos(valor.floatValue());
        try {
            notaSaida.setXml(carregarXML());
        } catch (IOException ex) {
            Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
        }
        notaSaida.setCahveAutorizacao(chaveAutorizacao);
        NotaSaidaController notaSaidaController = new NotaSaidaController();
        notaSaida = notaSaidaController.salvarNotaSaida(notaSaida);
   }
   
    public byte[] carregarXML() throws IOException {
        File file = this.arquivoXML;
        InputStream is = new FileInputStream(file);
        byte[] xml = new byte[(int) file.length()];
        int offset = 0;
        int numRead = 0;
        while (offset < xml.length
                && (numRead = is.read(xml, offset, xml.length - offset)) >= 0) {
            offset += numRead;
        }
        return xml;
    }

    public void carregarArquivoXMLLocalizado(File file) {
        if (file != null) {
            this.arquivoXML = file;
            this.notaCarregarda = true;
            if (notaCarregarda) {
                gravarNotaSaida();
                enviarEmailNFeCliente();
                imprimirDANFE();
            }
            this.telaConsulta.setModel();
            this.dispose();
            
        } else {
            JOptionPane.showMessageDialog(rootPane, "Erro carregar Arquivo XML");
            this.notaCarregarda = false;
        }
    }
    
    public void enviarEmailNFeCliente(){
        String cEmailDestino = emailjTextField.getText();
        String cArqXML = this.config.getCaminhoNFe() + this.arquivoXML.getName();
        String cEnviaPDF = "1";
        String cAssunto = "Segue em Anexo NF-e da empresa " + this.config.getEmpresa().getRazaoSocial();
        String cEmailsCopias = "angelacLenz@ig.com.br;jizidoro@globo.com";
        String texto = "NFe.EnviarEmail(" + cEmailDestino+ "," + 
                cArqXML + "," + cEnviaPDF + "," + cAssunto + "," +
                        cEmailsCopias+")";
        gerarArquivoAcbr(texto);
    }
    
    public void imprimirDANFE(){
        String cArqXML = this.config.getCaminhoNFe() + this.arquivoXML.getName();
        String texto = "NFe.ImprimirDANFE("+ cArqXML + ")";
        gerarArquivoAcbr(texto);
    }

    public void carregarFaturas(FaturaBean fatura, List<DuplicataBean> listaDuplicata) {
        if (fatura!=null){
            notaSaidaBean.setFatura(fatura);
            notaSaidaBean.getFatura().setListaDuplicata(listaDuplicata);
            numeroFaturajTextField.setText(fatura.getNumero());
            valorDescontoFaturajTextField.setText(Formatacao.foramtarFloatString(fatura.getValorDesconto()));
            valorOriginalFaturajTextField.setText(Formatacao.foramtarFloatString(fatura.getValorOrigianl()));
            valorLiquidoFaturajTextField.setText(Formatacao.foramtarFloatString(fatura.getValorLiquido()));
            carregarModelDuplicata();
        }   
    }
    
    public void carregarModelDuplicata(){
        if (notaSaidaBean.getFatura().getListaDuplicata()!=null){
            modelDuplicata = new DuplicataTableModel(notaSaidaBean.getFatura().getListaDuplicata());
        }else modelDuplicata = new DuplicataTableModel(new ArrayList<DuplicataBean>());
         DefaultTableCellRenderer renderer = new DefaultTableCellRenderer();
        renderer.setHorizontalAlignment(SwingConstants.RIGHT);
        duplicatajTable.setModel(modelDuplicata);
        duplicatajTable.getColumnModel().getColumn(0).setPreferredWidth(50);
        duplicatajTable.getColumnModel().getColumn(1).setPreferredWidth(50);
        duplicatajTable.getColumnModel().getColumn(2).setCellRenderer(renderer);
        duplicatajTable.getColumnModel().getColumn(2).setPreferredWidth(50);
        duplicatajTable.repaint();
    }

    public void setModel() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    public void filtrarNotaSaida(String sql) {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    public void consultaFornecedor(Fornecedor fornecedor) {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }
    
    
    
    class RemindTask extends TimerTask {

        public void run() {
            try {
                lerArquivoSaidaAcbr();
            } catch (IOException ex) {
                Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }
    
    public void carregarCahveAutorizacao(BufferedReader leitor){
        String linha=null;
        for(int i=0;i<1000;i++){
            try {
                linha = leitor.readLine();
                String dados = linha.substring(0, 5);
                if (dados.equalsIgnoreCase("ChNFe")){
                    chaveAutorizacao = linha.substring(6);
                    i=5000;
                }
            } catch (IOException ex) {
                Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
            }
          
        }
        
    }
    
    public boolean verificarRetornoNFe(BufferedReader leitor) {
        String linha = null;
        for (int i = 0; i < 1000; i++) {
            try {
                linha = leitor.readLine();
                String dados = "";
                if (linha != null) {
                    if (linha.length() > 8) {
                        dados = linha.substring(0, 7);
                    } else {
                        dados = linha.substring(0);
                    }
                } else {
                    linha = " ";
                }
                if (dados.equalsIgnoreCase("XMotivo")) {
                    String motivo = linha.substring(8);
                    if (motivo.equalsIgnoreCase("Autorizado o uso da NF-e")) {
                        JOptionPane.showMessageDialog(rootPane, motivo);
                        i = 5000;
                        return true;
                    }else {
                        if (!motivo.equalsIgnoreCase("Lote recebido com sucesso")){
                            JOptionPane.showMessageDialog(rootPane, motivo);
                            i = 5000;
                        }
                    }
                }
            } catch (IOException ex) {
                Logger.getLogger(FrmEmitirNotaSaida01.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
        return false;
    }
    
    public void buscarContasFatura(String numeroFatura){
        ContasReceberController contasReceberController = new ContasReceberController();
        String sql = "Select c from Contasreceber c where c.numeroFaturaGerada='" + numeroFatura + "' and c.cliente=" + cliente.getIdcliente();
        List<Contasreceber> listaContasReceber = contasReceberController.listarContas(sql);
        if (listaContasReceber!=null){
            if (listaContasReceber.size()>0){
                lancarProdutoFatura(listaContasReceber);
            }else {
                JOptionPane.showMessageDialog(rootPane, "Nenhuma conta Localziada");
            }
        }else {
            JOptionPane.showMessageDialog(rootPane, "Nenhuma conta Localziada");
        }
    }
    
    public void lancarProdutoFatura(List<Contasreceber> listaContasReceber) {
        List<Saida> listaProdutoContas = new ArrayList<Saida>();
        ContasReceberController contasReceberController = new ContasReceberController();
        for (int c = 0; c < listaContasReceber.size(); c++) {
            Contasreceberprodutos contasreceberprodutos = contasReceberController.consultarContasReceberProduto(listaContasReceber.get(c).getIdcontasReceber());
            if (contasreceberprodutos != null) {
                VendaController vendaController = new VendaController();
                listaProdutoContas = vendaController.listarSaidaVenda(contasreceberprodutos.getVenda().getIdvenda());
                numeroECFVenda = numeroECFVenda + listaContasReceber.get(c).getNumeroDocumento() + " - ";
                if (listaProdutoContas != null) {
                    for (int i = 0; i < listaProdutoContas.size(); i++) {
                        Saida saida = listaProdutoContas.get(i);
                        NotaSaidaProdutoBean notaSaidaProdutoBean = new NotaSaidaProdutoBean();
                        Produto produto = new Produto();
                        ProdutoController produtoController = new ProdutoController();
                        produto = produtoController.consultarProdutoid(saida.getProduto());
                        if (produto != null) {
                            notaSaidaProdutoBean.setProduto(produto);
                            notaSaidaProdutoBean.setQuantidade(saida.getQuantidade());
                            notaSaidaProdutoBean.setValorDesconto(0.0f);
                            notaSaidaProdutoBean.setValorUnitario(saida.getValorVenda() / saida.getQuantidade());
                            notaSaidaProdutoBean.setValortotal(saida.getValorVenda());
                            String aliquota = pesquisarAliquota(notaSaidaProdutoBean.getProduto().getAliquota());
                            if (aliquota.equalsIgnoreCase("ST")) {
                                Codigofiscal cf = (Codigofiscal) comSTjComboBox.getSelectedItem();
                                notaSaidaProdutoBean.setCfop(cf.getCfop());
                            } else {
                                Codigofiscal cf = (Codigofiscal) semSTjComboBox.getSelectedItem();
                                notaSaidaProdutoBean.setCfop(cf.getCfop());
                            }
                            listaProdutoBean.add(notaSaidaProdutoBean);
                        }
                    }
                }
            }
        }
        setModelProduto();
    }

    public String consultarCodgioMunicipio(int idMunicipio) {
        MunicipiosController municipiosController = new MunicipiosController();
        Municipios municipios = new Municipios();
        municipios = municipiosController.getMunicipio(idMunicipio);
        if (municipios != null) {
            return municipios.getCodigo();
        } else {
            return "0";
        }
    }

    public String validarFaturaDuplicata() {
        String erro = "0";
        if (numeroFaturajTextField.getText().equalsIgnoreCase("")) {
            erro = "Numero da Fatura em Branco";
            return erro;
        }
        if (valorDescontoFaturajTextField.getText().equalsIgnoreCase("")) {
            erro = "Valor do Desconto em Branco";
            return erro;
        }
        if (valorLiquidoFaturajTextField.getText().equalsIgnoreCase("")){
            erro = "Valor Liquido em Branco";
            return erro;
        }
        if (valorOriginalFaturajTextField.getText().equalsIgnoreCase("")){
            erro = "Valor Original em Branco";
            return erro;
        }
        if (numeroDuplicatajTextField.getText().equalsIgnoreCase("")){
            erro = "Numero Duplicata em Branco";
            return erro;
        }
        if (valorDuplicatajTextField.getText().equalsIgnoreCase("")){
            erro = "Valor Duplicata em Branco";
            return erro;
        }
        if (dataVencimentoDuplicatajDateChooser.getDate()==null){
            erro = "Data de Vencimento da Fatura inválida";
            return erro;
        }
        return erro;
        
    }
    
    
    
    public void calcularRateioDesconto(){
        Float desconto = Formatacao.formatarStringfloat(valorDescontojTextField.getText());
        Float valorTotal = Formatacao.formatarStringfloat(totalNotajTextField.getText());
        Float perDesconto= (desconto*100) / valorTotal;
        perDesconto = perDesconto/100;
        String vDesconto="";
        if (perDesconto>0){
            vDesconto = Formatacao.foramtarFloatString(perDesconto);
            perDesconto = Formatacao.formatarStringfloat(vDesconto);
        }
        
        notaSaidaBean.setPercentualDesconto(perDesconto);
    }
    
    public void apagarArquivoSaidaAcbr() throws IOException {
        File arqSaida = new File(this.config.getCaminhoAcbr() + "sainfe.txt");
        if (arqSaida.exists()) {
            arqSaida.delete();
        }
        File folder = new File(this.config.getCaminhoNFe());
        if (folder.isDirectory()) {
            File[] sun = folder.listFiles();
            for (File toDelete : sun) {
                toDelete.delete();
            }
        }
    }
    
    public String verficiarOepracao(){
        String estEmpresa = config.getEmpresa().getUf();
        String estDestinatario = estadojComboBox.getSelectedItem().toString();
        if (estEmpresa.equalsIgnoreCase(estDestinatario)){
            return "1";
        }else return "2";
    }
    
    public String verificarClienteICMS(){
        String tipoContribuinte = contribuintejComboBox.getSelectedItem().toString();
        if (tipoContribuinte.equalsIgnoreCase("1 - Contribuinto do ICMS")){
            return "1";
        }else if (tipoContribuinte.equalsIgnoreCase("2 - Contribuinte isento de IE")){
            return "2";
        }else return "9";
    }
    
    public String converterDataUTC(){
        SimpleDateFormat fmtHora = new SimpleDateFormat("HH:mm:ss");    
        SimpleDateFormat fmtData = new SimpleDateFormat("yyyy-MM-dd");    
        Date data = dataEmissaojDateChooser.getDate();
        String sHora = fmtHora.format(data);   // isto faz com que mostre do jeito que você quer  
        String sData = fmtData.format(data);   
        return sData + "T" + sHora+"-03:00";
    }
}